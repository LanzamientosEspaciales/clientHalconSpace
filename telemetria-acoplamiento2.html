<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Halcon Space - Telemetr√≠a de Acoplamiento</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      .timer-value {
        font-size: 2rem;
        min-width: 200px;
      }

      .timer-prefix {
        font-size: 1.8rem;
      }
    }

    html, body {
      height: 100%;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: #ffffff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
    }

    /* Animaci√≥n de estrellas de fondo */
    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    body::before {
      content: '';
      position: fixed;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(2px 2px at 20% 30%, white, transparent),
        radial-gradient(2px 2px at 60% 70%, white, transparent),
        radial-gradient(1px 1px at 50% 50%, white, transparent),
        radial-gradient(1px 1px at 80% 10%, white, transparent),
        radial-gradient(2px 2px at 90% 60%, white, transparent);
      background-size: 200% 200%;
      animation: twinkle 4s ease-in-out infinite;
      opacity: 0.4;
      pointer-events: none;
    }

    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
    }

    header {
      background: linear-gradient(180deg, rgba(17, 17, 17, 0.95) 0%, rgba(17, 17, 17, 0.85) 100%);
      backdrop-filter: blur(10px);
      padding: 25px 20px;
      text-align: center;
      border-bottom: 2px solid rgba(0, 255, 204, 0.3);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      position: relative;
      z-index: 10;
    }

    header img {
      height: 70px;
      filter: drop-shadow(0 0 10px rgba(0, 255, 204, 0.5));
      transition: transform 0.3s ease;
    }

    header img:hover {
      transform: scale(1.05);
    }

    header h1 {
      margin: 12px 0 0;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: 2px;
      text-shadow: 0 0 20px rgba(0, 255, 204, 0.5);
    }

    header .mission {
      font-size: 1.3rem;
      font-weight: 300;
      color: #00ffcc;
      display: block;
      margin-top: 8px;
      text-transform: uppercase;
      letter-spacing: 3px;
      animation: pulse 2s ease-in-out infinite;
    }

    .mission-timer-header {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .timer-display {
      background: linear-gradient(135deg, rgba(255, 204, 0, 0.15) 0%, rgba(255, 153, 0, 0.15) 100%);
      border: 2px solid #ffcc00;
      border-radius: 20px;
      padding: 15px 40px;
      display: inline-flex;
      align-items: baseline;
      gap: 8px;
      box-shadow: 
        0 0 30px rgba(255, 204, 0, 0.3),
        inset 0 2px 10px rgba(255, 204, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    .timer-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      animation: timer-shine 3s ease-in-out infinite;
    }

    @keyframes timer-shine {
      0%, 100% { left: -100%; }
      50% { left: 100%; }
    }

    .timer-prefix {
      font-size: 2.5rem;
      font-weight: 900;
      font-family: 'Courier New', monospace;
      color: #ffcc00;
      text-shadow: 
        0 0 20px rgba(255, 204, 0, 0.8),
        0 0 40px rgba(255, 204, 0, 0.4);
      letter-spacing: 2px;
    }

    .timer-prefix.countdown {
      color: #ff6b6b;
      text-shadow: 
        0 0 20px rgba(255, 107, 107, 0.8),
        0 0 40px rgba(255, 107, 107, 0.4);
    }

    .timer-value {
      font-size: 2.8rem;
      font-weight: 700;
      font-family: 'Courier New', monospace;
      color: #ffffff;
      text-shadow: 
        0 0 25px rgba(255, 255, 255, 0.6),
        0 2px 4px rgba(0, 0, 0, 0.5);
      letter-spacing: 3px;
      min-width: 280px;
      text-align: center;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 30px 20px;
      gap: 30px;
      position: relative;
      z-index: 1;
    }

    .status-indicator {
      text-align: center;
      margin-bottom: 10px;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: rgba(0, 255, 204, 0.1);
      border: 1px solid #00ffcc;
      border-radius: 25px;
      padding: 10px 25px;
      font-size: 1.1rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .status-badge.inactive {
      background: rgba(255, 68, 68, 0.1);
      border-color: #ff4444;
    }

    .status-badge.inactive .status-dot {
      background: #ff4444;
      box-shadow: 0 0 10px #ff4444;
      animation: none;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      background: #00ffcc;
      border-radius: 50%;
      animation: blink 1.5s ease-in-out infinite;
      box-shadow: 0 0 10px #00ffcc;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
    }

    .card {
      background: linear-gradient(145deg, rgba(17, 17, 17, 0.9) 0%, rgba(30, 30, 45, 0.9) 100%);
      border: 1px solid rgba(0, 255, 204, 0.3);
      border-radius: 15px;
      padding: 25px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, transparent, #00ffcc, transparent);
      animation: shimmer 3s ease-in-out infinite;
    }

    @keyframes shimmer {
      0%, 100% { transform: translateX(-100%); }
      50% { transform: translateX(100%); }
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 255, 204, 0.2);
      border-color: #00ffcc;
    }

    .card h2 {
      margin-bottom: 20px;
      color: #00ffcc;
      font-size: 1.5rem;
      font-weight: 600;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
    }

    .dato {
      font-size: 1.15rem;
      margin: 12px 0;
      padding: 12px 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      border-left: 3px solid #00ffcc;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .dato:hover {
      background: rgba(0, 255, 204, 0.1);
      transform: translateX(5px);
    }

    .dato-icon {
      font-size: 1.3rem;
      min-width: 25px;
    }

    .relativo {
      background: linear-gradient(145deg, rgba(30, 30, 45, 0.95) 0%, rgba(17, 17, 17, 0.95) 100%);
      border: 2px solid rgba(255, 204, 0, 0.5);
      border-radius: 15px;
      padding: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(255, 204, 0, 0.2);
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
      position: relative;
      overflow: hidden;
    }

    .relativo::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, transparent, #ffcc00, transparent);
      animation: shimmer 3s ease-in-out infinite;
    }

    .relativo h2 {
      margin-bottom: 25px;
      color: #ffcc00;
      font-size: 1.8rem;
      font-weight: 700;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 3px;
      text-shadow: 0 0 15px rgba(255, 204, 0, 0.6);
    }

    .progress-wrapper {
      margin-top: 25px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
    }

    .progress-label {
      font-size: 1.15rem;
      margin-bottom: 12px;
      text-align: center;
      font-weight: 600;
      color: #ffcc00;
    }

    .progress-container {
      background: rgba(68, 68, 68, 0.5);
      border-radius: 15px;
      height: 30px;
      width: 100%;
      overflow: hidden;
      border: 1px solid rgba(255, 204, 0, 0.3);
      box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.5);
      position: relative;
    }

    .progress-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 255, 255, 0.1) 50%, 
        transparent 100%);
      animation: progress-shine 2s ease-in-out infinite;
    }

    @keyframes progress-shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ff4444, #ffaa00, #44ff44);
      transition: width 0.8s ease;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
      position: relative;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, 
        rgba(255, 255, 255, 0.3) 0%, 
        transparent 50%);
      border-radius: 15px;
    }

    footer {
      background: linear-gradient(180deg, rgba(17, 17, 17, 0.85) 0%, rgba(17, 17, 17, 0.95) 100%);
      backdrop-filter: blur(10px);
      padding: 20px;
      font-size: 0.95rem;
      color: #aaa;
      text-align: center;
      border-top: 2px solid rgba(0, 255, 204, 0.3);
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
      position: relative;
      z-index: 10;
    }

    @media (max-width: 768px) {
      header h1 {
        font-size: 1.8rem;
      }

      header .mission {
        font-size: 1.1rem;
      }

      .card h2, .relativo h2 {
        font-size: 1.3rem;
      }

      .dato {
        font-size: 1rem;
      }

      main {
        padding: 20px 15px;
      }
    }

    /* Loading animation */
    .loading {
      opacity: 0.5;
      animation: loading-pulse 1.5s ease-in-out infinite;
    }

    @keyframes loading-pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 0.8; }
    }
  </style>
</head>
<body>
  <header>
    <img src="https://halconspace.site/img/logo.png" alt="Logo Halcon Space">
    <h1>HALCON SPACE</h1>
    <span id="mission-name" class="mission">‚∏∫ ACOPLAMIENTO ‚∏∫</span>
    <div class="mission-timer-header" id="mission-timer-header" style="display: none;">
      <div class="timer-display">
        <span class="timer-prefix" id="timer-prefix">T+</span>
        <span class="timer-value" id="timer-value">00:00:00</span>
      </div>
    </div>
  </header>

  <main>
    <div class="status-indicator">
      <div class="status-badge" id="status-badge">
        <span class="status-dot" id="status-dot"></span>
        <span id="status-text">Esperando datos...</span>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2 id="nave-nombre">üöÄ Nave</h2>
        <div id="nave-altura" class="dato loading">
          <span class="dato-icon">üöÄ</span>
          <span>Altura: -- km</span>
        </div>
        <div id="nave-velocidad" class="dato loading">
          <span class="dato-icon">‚ö°</span>
          <span>Velocidad: -- km/h</span>
        </div>
        <div id="nave-inclinacion" class="dato loading">
          <span class="dato-icon">üõ∞Ô∏è</span>
          <span>Inclinaci√≥n: -- ¬∞</span>
        </div>
        <div id="nave-orbita" class="dato loading">
          <span class="dato-icon">ü™ê</span>
          <span>√ìrbita: -- x -- km</span>
        </div>
      </div>

      <div class="card">
        <h2 id="estacion-nombre">üè† Estaci√≥n</h2>
        <div id="estacion-altura" class="dato loading">
          <span class="dato-icon">üè†</span>
          <span>Altura: -- km</span>
        </div>
        <div id="estacion-velocidad" class="dato loading">
          <span class="dato-icon">‚ö°</span>
          <span>Velocidad: -- km/h</span>
        </div>
        <div id="estacion-inclinacion" class="dato loading">
          <span class="dato-icon">üõ∞Ô∏è</span>
          <span>Inclinaci√≥n: -- ¬∞</span>
        </div>
        <div id="estacion-orbita" class="dato loading">
          <span class="dato-icon">ü™ê</span>
          <span>√ìrbita: -- x -- km</span>
        </div>
      </div>
    </div>

    <div class="relativo">
      <h2>‚ö° DATOS RELATIVOS ‚ö°</h2>
      <div id="rel-distancia" class="dato loading">
        <span class="dato-icon">üìè</span>
        <span>Distancia: -- m</span>
      </div>
      <div id="rel-velocidad" class="dato loading">
        <span class="dato-icon">üîÑ</span>
        <span>Velocidad relativa: -- km/h</span>
      </div>
      <div class="progress-wrapper">
        <div id="progress-label" class="progress-label">Aproximaci√≥n: 0% (m√°x: 2000 m)</div>
        <div class="progress-container">
          <div id="progress-bar" class="progress-bar"></div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    ¬© 2025 Halcon Space - Sistema de Telemetr√≠a de Acoplamiento Orbital
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAiLw2zwfsjdMP-IlEoE5JugyFvmaQLFC0",
      authDomain: "halcon-space-348e7.firebaseapp.com",
      projectId: "halcon-space-348e7",
      storageBucket: "halcon-space-348e7.firebasestorage.app",
      messagingSenderId: "741724706453",
      appId: "1:741724706453:web:519531e63f2b923f952d9c",
      measurementId: "G-VG1Y2YMY4W"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let maxDistancia = 2000;
    let naveName = "Cargo Dragon";
    let estacionName = "JMS Space Station";
    const MISSION_ID = "64sbwfNYFvFDU8psFhpm"; // ID de la misi√≥n a consultar

    let telemetriaActiva = false;
    let launchTime = null;
    let timerInterval = null;

    document.getElementById("nave-nombre").innerHTML = `üöÄ ${naveName}`;
    document.getElementById("estacion-nombre").innerHTML = `üè† ${estacionName}`;

    function removeLoading(elementId) {
      const el = document.getElementById(elementId);
      if (el) el.classList.remove('loading');
    }

    function updateMissionTimer() {
      if (!launchTime) return;

      const now = new Date();
      const diff = now - launchTime; // diferencia en milisegundos
      const isCountdown = diff < 0;
      const absDiff = Math.abs(diff);
      const totalSeconds = Math.floor(absDiff / 1000);

      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      let timeString;
      if (days > 0) {
        // Formato con d√≠as: T+10d 15:13:50
        timeString = `${days}d ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      } else {
        // Formato sin d√≠as: T+15:13:50
        timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      }

      const prefixEl = document.getElementById("timer-prefix");
      const valueEl = document.getElementById("timer-value");
      
      if (isCountdown) {
        prefixEl.innerText = "T-";
        prefixEl.classList.add("countdown");
      } else {
        prefixEl.innerText = "T+";
        prefixEl.classList.remove("countdown");
      }
      
      valueEl.innerText = timeString;
    }

    function updateUIState(telemetriaOn) {
      const statusBadge = document.getElementById("status-badge");
      const statusDot = document.getElementById("status-dot");
      const statusText = document.getElementById("status-text");
      const missionTimerHeader = document.getElementById("mission-timer-header");
      const mainContent = document.querySelector("main .grid");
      const relativoSection = document.querySelector(".relativo");

      if (telemetriaOn) {
        statusBadge.classList.remove("inactive");
        statusText.innerText = "Telemetr√≠a Activa";
        missionTimerHeader.style.display = "flex";
        if (mainContent) mainContent.style.display = "grid";
        if (relativoSection) relativoSection.style.display = "block";
      } else {
        statusBadge.classList.add("inactive");
        statusText.innerText = "Telemetr√≠a Inactiva";
        missionTimerHeader.style.display = "none";
        if (mainContent) mainContent.style.display = "none";
        if (relativoSection) relativoSection.style.display = "none";
      }
    }

    // Listener para datos de la misi√≥n (lanzamiento)
    const refMision = doc(db, "lanzamientos", MISSION_ID);
    onSnapshot(refMision, (snap) => {
      console.log("Snapshot de misi√≥n recibido:", snap.exists());
      if (snap.exists()) {
        const misionData = snap.data();
        console.log("Datos de misi√≥n:", misionData);
        
        // Verificar telemetria_on desde los datos de misi√≥n
        if (misionData.telemetria_on !== undefined) {
          const nuevaTelemetriaActiva = misionData.telemetria_on === true;
          console.log("telemetria_on encontrado en misi√≥n:", misionData.telemetria_on);
          
          if (nuevaTelemetriaActiva !== telemetriaActiva) {
            telemetriaActiva = nuevaTelemetriaActiva;
            console.log("Cambio de estado de telemetr√≠a a:", telemetriaActiva);
            updateUIState(telemetriaActiva);
            
            // Iniciar o detener el timer
            if (telemetriaActiva && launchTime) {
              if (timerInterval) clearInterval(timerInterval);
              timerInterval = setInterval(updateMissionTimer, 1000);
              updateMissionTimer();
            } else if (!telemetriaActiva) {
              if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
              }
            }
          }
        }
        
        if (misionData.utcTime) {
          launchTime = new Date(misionData.utcTime);
          console.log("Launch time establecido:", launchTime);
          
          // Iniciar el timer si la telemetr√≠a est√° activa
          if (telemetriaActiva) {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(updateMissionTimer, 1000);
            updateMissionTimer(); // Actualizar inmediatamente
          }
        } else {
          console.log("No se encontr√≥ utcTime en los datos");
        }
      } else {
        console.log("El documento lanzamientos/" + MISSION_ID + " NO existe");
      }
    });

    const refConfig = doc(db, "telemetria", "config");
    onSnapshot(refConfig, (snap) => {
      if (snap.exists() && snap.data().max_distancia !== undefined) {
        maxDistancia = snap.data().max_distancia;
        document.getElementById("progress-label").innerText =
          `Aproximaci√≥n: 0% (m√°x: ${maxDistancia} m)`;
      }
    });

    const refTelemetria = doc(db, "telemetria", "estado_actual");
    onSnapshot(refTelemetria, (snap) => {
      if (!snap.exists()) {
        console.log("El documento telemetria/estado_actual NO existe");
        return;
      }
      const tData = snap.data();
      console.log("Datos de telemetr√≠a recibidos");

      // Solo mostrar datos si la telemetr√≠a est√° activa
      if (!telemetriaActiva) {
        console.log("Telemetr√≠a inactiva, no se muestran datos");
        return;
      }

      if (tData.altitude_m !== undefined) {
        const el = document.getElementById("nave-altura");
        el.innerHTML = `<span class="dato-icon">üöÄ</span><span>Altura: ${(tData.altitude_m / 1000).toFixed(1)} km</span>`;
        removeLoading('nave-altura');
      }
      if (tData.velocity_kmh !== undefined) {
        const el = document.getElementById("nave-velocidad");
        el.innerHTML = `<span class="dato-icon">‚ö°</span><span>Velocidad: ${tData.velocity_kmh} km/h</span>`;
        removeLoading('nave-velocidad');
      }
      if (tData.inclination !== undefined) {
        const el = document.getElementById("nave-inclinacion");
        el.innerHTML = `<span class="dato-icon">üõ∞Ô∏è</span><span>Inclinaci√≥n: ${tData.inclination.toFixed(2)} ¬∞</span>`;
        removeLoading('nave-inclinacion');
      }
      if (tData.perigeo !== undefined && tData.apogeo !== undefined) {
        const perigeoKm = Math.round(tData.perigeo / 1000);
        const apogeoKm = Math.round(tData.apogeo / 1000);
        const el = document.getElementById("nave-orbita");
        el.innerHTML = `<span class="dato-icon">ü™ê</span><span>√ìrbita: ${perigeoKm} x ${apogeoKm} km</span>`;
        removeLoading('nave-orbita');
      }

      if (tData.objetivo) {
        if (tData.objetivo.altitude_m !== undefined) {
          const el = document.getElementById("estacion-altura");
          el.innerHTML = `<span class="dato-icon">üè†</span><span>Altura: ${(tData.objetivo.altitude_m / 1000).toFixed(1)} km</span>`;
          removeLoading('estacion-altura');
        }
        if (tData.objetivo.velocity_kmh !== undefined) {
          const el = document.getElementById("estacion-velocidad");
          el.innerHTML = `<span class="dato-icon">‚ö°</span><span>Velocidad: ${tData.objetivo.velocity_kmh} km/h</span>`;
          removeLoading('estacion-velocidad');
        }
        if (tData.objetivo.inclination !== undefined) {
          const el = document.getElementById("estacion-inclinacion");
          el.innerHTML = `<span class="dato-icon">üõ∞Ô∏è</span><span>Inclinaci√≥n: ${tData.objetivo.inclination.toFixed(2)} ¬∞</span>`;
          removeLoading('estacion-inclinacion');
        }
        if (tData.objetivo.perigeo !== undefined && tData.objetivo.apogeo !== undefined) {
          const perigeoObjKm = Math.round(tData.objetivo.perigeo / 1000);
          const apogeoObjKm = Math.round(tData.objetivo.apogeo / 1000);
          const el = document.getElementById("estacion-orbita");
          el.innerHTML = `<span class="dato-icon">ü™ê</span><span>√ìrbita: ${perigeoObjKm} x ${apogeoObjKm} km</span>`;
          removeLoading('estacion-orbita');
        }

        if (tData.objetivo.distancia !== undefined) {
          const distanciaM = tData.objetivo.distancia;
          let displayDistancia;
                
          if (distanciaM > 100000) {
            displayDistancia = `${Math.round(distanciaM / 1000)} km`;
          } else if (distanciaM > 10000) {
            displayDistancia = `${(distanciaM / 1000).toFixed(1)} km`;
          } else {
            displayDistancia = `${Math.round(distanciaM)} m`;
          }

          const el = document.getElementById("rel-distancia");
          el.innerHTML = `<span class="dato-icon">üìè</span><span>Distancia: ${displayDistancia}</span>`;
          removeLoading('rel-distancia');

          const porcentaje = Math.max(0, Math.min(100, (1 - distanciaM / maxDistancia) * 100));
          document.getElementById("progress-bar").style.width = `${porcentaje}%`;
          document.getElementById("progress-label").innerText =
            `Aproximaci√≥n: ${porcentaje.toFixed(1)}% (m√°x: ${maxDistancia} m)`;
        }

        if (tData.objetivo.velocidad_relativa !== undefined) {
          const el = document.getElementById("rel-velocidad");
          el.innerHTML = `<span class="dato-icon">üîÑ</span><span>Velocidad relativa: ${tData.objetivo.velocidad_relativa} km/h</span>`;
          removeLoading('rel-velocidad');
        }
      }
    });
  </script>
</body>
</html>